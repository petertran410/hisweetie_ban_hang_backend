generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String?
  phone     String?
  avatar    String?
  googleId  String?  @unique
  branchId  Int?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branch                Branch?         @relation(fields: [branchId], references: [id])
  userRoles             UserRole[]
  createdOrders         Order[]         @relation("OrderCreator")
  soldOrders            Order[]         @relation("OrderSeller")
  createdInvoices       Invoice[]       @relation("InvoiceCreator")
  soldInvoices          Invoice[]       @relation("InvoiceSeller")
  createdPayments       OrderPayment[]  @relation("PaymentCreator")
  createdPurchaseOrders PurchaseOrder[] @relation("PurchaseOrderCreator")
  purchaseOrders        PurchaseOrder[] @relation("PurchaseOrderBuyer")
  posts                 Post[]          @relation("PostAuthor")
  priceBookUsers        PriceBookUser[]
  createdTransfers      Transfer[]      @relation("TransferCreator")
  createdCustomerGroups CustomerGroup[] @relation("CustomerGroupCreator")

  @@map("users")
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  userRoles       UserRole[]
  rolePermissions RolePermission[]

  @@map("roles")
}

model Permission {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  resource    String
  action      String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  rolePermissions RolePermission[]

  @@unique([resource, action])
  @@map("permissions")
}

model UserRole {
  userId    Int
  roleId    Int
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@map("user_roles")
}

model RolePermission {
  roleId       Int
  permissionId Int
  createdAt    DateTime @default(now())

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
  @@map("role_permissions")
}

// ==================== BRANCH & LOCATION ====================

model Branch {
  id               Int      @id @default(autoincrement())
  name             String
  code             String?  @unique
  contactNumber    String?
  subContactNumber String?
  email            String?
  address          String?
  locationId       Int?
  wardName         String?
  isActive         Boolean  @default(true)
  isLock           Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  location          Location?         @relation(fields: [locationId], references: [id])
  users             User[]
  orders            Order[]
  invoices          Invoice[]
  purchaseOrders    PurchaseOrder[]
  inventories       Inventory[]
  priceBookBranches PriceBookBranch[]
  customers         Customer[]
  transfersFrom Transfer[] @relation("TransferFrom")
  transfersTo   Transfer[] @relation("TransferTo")

  @@map("branches")
}

model Location {
  id         Int      @id @default(autoincrement())
  name       String
  normalName String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  branches          Branch[]
  orderDeliveries   OrderDelivery[]
  invoiceDeliveries InvoiceDelivery[]

  @@map("locations")
}

// ==================== CUSTOMER ====================

model CustomerType {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  customers Customer[]

  @@map("customer_types")
}

model CustomerGroup {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdBy   Int?
  createdAt   DateTime @default(now())

  creator                 User?                       @relation("CustomerGroupCreator", fields: [createdBy], references: [id])
  customerGroupDetails    CustomerGroupDetail[]
  priceBookCustomerGroups PriceBookCustomerGroup[]

  @@map("customer_groups")
}

model Customer {
  id             Int       @id @default(autoincrement())
  code           String?   @unique
  name           String
  gender         Boolean?
  birthDate      DateTime?
  contactNumber  String?
  phone          String?
  email          String?
  cityCode       String?
  cityName       String?
  districtCode   String?
  districtName   String?
  wardCode       String?
  wardName       String?
  address        String?
  type           Int       @default(0)
  organization   String?
  taxCode        String?
  groups         String?
  invoiceBuyerName        String?
  invoiceCityCode         String?
  invoiceCityName         String?
  invoiceWardCode         String?
  invoiceWardName         String?
  invoiceAddress          String?
  invoiceCccdCmnd         String?
  invoiceBankAccount      String?
  invoiceEmail            String?
  invoicePhone            String?
  invoiceDvqhnsCode       String?
  comments       String?
  customerTypeId Int?
  branchId       Int?
  totalPurchased Decimal   @default(0)
  totalDebt      Decimal   @default(0)
  totalInvoiced  Decimal   @default(0)
  totalPoint     Decimal   @default(0)
  totalRevenue   Decimal   @default(0)
  rewardPoint    Int       @default(0)
  locationName   String?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  customerType         CustomerType?         @relation(fields: [customerTypeId], references: [id])
  branch               Branch?               @relation(fields: [branchId], references: [id])
  customerGroupDetails CustomerGroupDetail[]
  orders               Order[]
  invoices             Invoice[]

  @@map("customers")
}

model CustomerGroupDetail {
  id              Int      @id @default(autoincrement())
  customerId      Int
  customerGroupId Int

  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerGroup CustomerGroup @relation(fields: [customerGroupId], references: [id], onDelete: Cascade)

  @@unique([customerId, customerGroupId])
  @@map("customer_group_details")
}

model Supplier {
  id            Int      @id @default(autoincrement())
  code          String?  @unique
  name          String
  contactNumber String?
  phone         String?
  email         String?
  address       String?
  contactPerson String?
  comments      String?
  totalDebt     Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  purchaseOrders PurchaseOrder[]

  @@map("suppliers")
}

model TradeMark {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]

  @@map("trade_marks")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String
  parentId  Int?
  hasChild  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent   Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children Category[] @relation("CategoryToCategory")
  products Product[]

  @@map("categories")
}

model ProductVariant {
  id          Int      @id @default(autoincrement())
  name        String
  code        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products Product[]

  @@map("product_variants")
}

model Product {
  id              Int      @id @default(autoincrement())
  code            String   @unique
  name            String
  fullName        String?
  description     String?
  orderTemplate   String?
  categoryId      Int?
  tradeMarkId     Int?
  variantId       Int?
  masterProductId Int?
  masterUnitId    Int?
  type            Int      @default(2)
  allowsSale      Boolean  @default(true)
  hasVariants     Boolean  @default(false)
  basePrice       Decimal  @default(0)
  unit            String?
  conversionValue Decimal  @default(1)
  weight          Decimal?
  weightUnit      String?  @default("kg")
  attributesText  String?
  isRewardPoint   Boolean  @default(true)
  isActive        Boolean  @default(true)
  isDirectSale    Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  priceBookId     Int?

  category           Category?           @relation(fields: [categoryId], references: [id])
  tradeMark          TradeMark?          @relation(fields: [tradeMarkId], references: [id])
  variant            ProductVariant?     @relation(fields: [variantId], references: [id])
  masterProduct      Product?            @relation("ProductUnits", fields: [masterProductId], references: [id])
  productUnits       Product[]           @relation("ProductUnits")
  attributes         ProductAttribute[]
  images             ProductImage[]
  inventories        Inventory[]
  priceBookDetails   PriceBookDetail[]
  orderItems         OrderItem[]
  invoiceDetails     InvoiceDetail[]
  purchaseOrderItems PurchaseOrderItem[]
  comboComponents    ProductComponent[]  @relation("ComboComponents")
  componentOf        ProductComponent[]  @relation("ComponentOf")
  priceBook          PriceBook?          @relation(fields: [priceBookId], references: [id])
  transferDetails TransferDetail[]

  @@map("products")
}

model ProductComponent {
  id                 Int      @id @default(autoincrement())
  comboProductId     Int
  componentProductId Int
  quantity           Decimal
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  comboProduct     Product @relation("ComboComponents", fields: [comboProductId], references: [id], onDelete: Cascade)
  componentProduct Product @relation("ComponentOf", fields: [componentProductId], references: [id], onDelete: Cascade)

  @@unique([comboProductId, componentProductId])
  @@map("product_components")
}

model ProductAttribute {
  id             Int      @id @default(autoincrement())
  productId      Int
  attributeName  String
  attributeValue String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_attributes")
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  productId Int
  image     String
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model Inventory {
  id          Int      @id @default(autoincrement())
  productId   Int
  productCode String
  productName String
  branchId    Int
  branchName  String
  cost        Decimal  @default(0)
  onHand      Decimal  @default(0)
  reserved    Decimal  @default(0)
  onOrder     Decimal  @default(0)
  minQuality  Decimal  @default(0)
  maxQuality  Decimal  @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  branch  Branch  @relation(fields: [branchId], references: [id])

  @@unique([productId, branchId])
  @@map("inventories")
}

model PriceBook {
  id                     Int       @id @default(autoincrement())
  name                   String
  isActive               Boolean   @default(true)
  isGlobal               Boolean   @default(false)
  startDate              DateTime?
  endDate                DateTime?
  allowNonListedProducts Boolean   @default(true)
  warnNonListedProducts  Boolean   @default(false)
  priority               Int       @default(0)
  forAllCusGroup         Boolean   @default(false)
  forAllUser             Boolean   @default(false)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  priceBookDetails        PriceBookDetail[]
  priceBookBranches       PriceBookBranch[]
  priceBookCustomerGroups PriceBookCustomerGroup[]
  priceBookUsers          PriceBookUser[]
  Product                 Product[]

  @@map("price_books")
}

model PriceBookDetail {
  id          Int       @id @default(autoincrement())
  priceBookId Int
  productId   Int
  price       Decimal  
  isActive    Boolean   @default(true)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  priceBook PriceBook @relation(fields: [priceBookId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([priceBookId, productId])
  @@map("price_book_details")
}

model PriceBookBranch {
  id          Int      @id @default(autoincrement())
  priceBookId Int
  branchId    Int
  branchName  String
  createdAt   DateTime @default(now())

  priceBook PriceBook @relation(fields: [priceBookId], references: [id], onDelete: Cascade)
  branch    Branch    @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([priceBookId, branchId])
  @@map("price_book_branches")
}

model PriceBookCustomerGroup {
  id                Int      @id @default(autoincrement())
  priceBookId       Int
  customerGroupId   Int
  customerGroupName String
  createdAt         DateTime @default(now())

  priceBook     PriceBook     @relation(fields: [priceBookId], references: [id], onDelete: Cascade)
  customerGroup CustomerGroup @relation(fields: [customerGroupId], references: [id], onDelete: Cascade)

  @@unique([priceBookId, customerGroupId])
  @@map("price_book_customer_groups")
}

model PriceBookUser {
  id          Int      @id @default(autoincrement())
  priceBookId Int
  userId      Int
  userName    String
  createdAt   DateTime @default(now())

  priceBook PriceBook @relation(fields: [priceBookId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([priceBookId, userId])
  @@map("price_book_users")
}

model SaleChannel {
  id         Int      @id @default(autoincrement())
  name       String
  position   Int      @default(0)
  isActivate Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  orders   Order[]
  invoices Invoice[]

  @@map("sale_channels")
}

model Surcharge {
  id         Int      @id @default(autoincrement())
  code       String   @unique
  name       String
  valueRatio Decimal?
  value      Decimal?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  orderSurcharges         OrderSurcharge[]
  invoiceSurcharges       InvoiceSurcharge[]
  purchaseOrderSurcharges PurchaseOrderSurcharge[]

  @@map("surcharges")
}

model BankAccount {
  id            Int      @id @default(autoincrement())
  bankName      String
  accountNumber String
  description   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  orderPayments         OrderPayment[]
  invoicePayments       InvoicePayment[]
  purchaseOrderPayments PurchaseOrderPayment[]

  @@map("bank_accounts")
}

model PartnerDelivery {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  name          String
  address       String?
  contactNumber String?
  email         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  orderDeliveries   OrderDelivery[]
  invoiceDeliveries InvoiceDelivery[]

  @@map("partner_deliveries")
}

// ==================== ORDER (ĐẶT HÀNG) ====================

model Order {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  customerId    Int?
  branchId      Int?
  soldById      Int?
  saleChannelId Int?
  orderDate     DateTime @default(now())
  totalAmount   Decimal  @default(0)
  discount      Decimal  @default(0)
  discountRatio Decimal  @default(0)
  grandTotal    Decimal  @default(0)
  paidAmount    Decimal  @default(0)
  debtAmount    Decimal  @default(0)
  depositAmount Decimal  @default(0)
  paymentStatus String   @default("Draft")
  orderStatus   String   @default("Draft")
  status        Int      @default(1)
  statusValue   String?
  usingCod      Boolean  @default(false)
  description   String?
  createdBy     Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  customer    Customer?        @relation(fields: [customerId], references: [id])
  branch      Branch?          @relation(fields: [branchId], references: [id])
  soldBy      User?            @relation("OrderSeller", fields: [soldById], references: [id])
  saleChannel SaleChannel?     @relation(fields: [saleChannelId], references: [id])
  creator     User             @relation("OrderCreator", fields: [createdBy], references: [id])
  items       OrderItem[]
  payments    OrderPayment[]
  surcharges  OrderSurcharge[]
  delivery    OrderDelivery?

  @@map("orders")
}

model OrderItem {
  id            Int      @id @default(autoincrement())
  orderId       Int
  productId     Int
  productCode   String
  productName   String
  quantity      Decimal
  price         Decimal 
  appliedPrice  Decimal   // THÊM FIELD NÀY
  discount      Decimal  @default(0)
  discountRatio Decimal  @default(0)
  totalPrice    Decimal 
  note          String?
  serialNumbers String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])
  
  @@map("order_items")
}

model OrderPayment {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  orderId       Int
  amount        Decimal 
  paymentDate   DateTime @default(now())
  paymentMethod String   @default("cash")
  accountId     Int?
  bankAccount   String?
  description   String?
  status        Int      @default(1)
  statusValue   String?
  createdBy     Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  order   Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  account BankAccount? @relation(fields: [accountId], references: [id])
  creator User         @relation("PaymentCreator", fields: [createdBy], references: [id])

  @@map("order_payments")
}

model OrderSurcharge {
  id            Int      @id @default(autoincrement())
  orderId       Int
  surchargeId   Int?
  surchargeName String
  surValue      Decimal?
  price         Decimal?
  createdAt     DateTime @default(now())

  order     Order      @relation(fields: [orderId], references: [id], onDelete: Cascade)
  surcharge Surcharge? @relation(fields: [surchargeId], references: [id])

  @@map("order_surcharges")
}

model OrderDelivery {
  id                Int       @id @default(autoincrement())
  orderId           Int       @unique
  deliveryCode      String?
  type              Int?
  status            Int       @default(1)
  statusValue       String?
  price             Decimal? 
  receiver          String
  contactNumber     String
  address           String
  locationId        Int?
  locationName      String?
  wardName          String?
  weight            Decimal?
  length            Decimal?
  width             Decimal?
  height            Decimal?
  noteForDriver     String?
  partnerDeliveryId Int?
  expectedDelivery  DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  order           Order            @relation(fields: [orderId], references: [id], onDelete: Cascade)
  location        Location?        @relation(fields: [locationId], references: [id])
  partnerDelivery PartnerDelivery? @relation(fields: [partnerDeliveryId], references: [id])

  @@map("order_deliveries")
}

// ==================== INVOICE (HÓA ĐƠN) ====================

model Invoice {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  customerId    Int?
  branchId      Int?
  soldById      Int?
  saleChannelId Int?
  purchaseDate  DateTime @default(now())
  totalAmount   Decimal  @default(0)
  discount      Decimal  @default(0)
  discountRatio Decimal  @default(0)
  grandTotal    Decimal  @default(0)
  paidAmount    Decimal  @default(0)
  debtAmount    Decimal  @default(0)
  status        Int      @default(1)
  statusValue   String?
  usingCod      Boolean  @default(false)
  description   String?
  createdBy     Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  customer    Customer?          @relation(fields: [customerId], references: [id])
  branch      Branch?            @relation(fields: [branchId], references: [id])
  soldBy      User?              @relation("InvoiceSeller", fields: [soldById], references: [id])
  saleChannel SaleChannel?       @relation(fields: [saleChannelId], references: [id])
  creator     User               @relation("InvoiceCreator", fields: [createdBy], references: [id])
  details     InvoiceDetail[]
  payments    InvoicePayment[]
  surcharges  InvoiceSurcharge[]
  delivery    InvoiceDelivery?

  @@map("invoices")
}

model InvoiceDetail {
  id            Int      @id @default(autoincrement())
  invoiceId     Int
  productId     Int
  productCode   String
  productName   String
  quantity      Decimal
  price         Decimal 
  discount      Decimal  @default(0)
  discountRatio Decimal  @default(0)
  totalPrice    Decimal 
  note          String?
  serialNumbers String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("invoice_details")
}

model InvoicePayment {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  invoiceId     Int
  amount        Decimal 
  paymentDate   DateTime @default(now())
  paymentMethod String   @default("cash")
  accountId     Int?
  bankAccount   String?
  description   String?
  status        Int      @default(1)
  statusValue   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  invoice Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  account BankAccount? @relation(fields: [accountId], references: [id])

  @@map("invoice_payments")
}

model InvoiceSurcharge {
  id            Int      @id @default(autoincrement())
  invoiceId     Int
  surchargeId   Int?
  surchargeName String
  surValue      Decimal?
  price         Decimal?
  createdAt     DateTime @default(now())

  invoice   Invoice    @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  surcharge Surcharge? @relation(fields: [surchargeId], references: [id])

  @@map("invoice_surcharges")
}

model InvoiceDelivery {
  id                Int      @id @default(autoincrement())
  invoiceId         Int      @unique
  deliveryCode      String?
  type              Int?
  status            Int      @default(1)
  statusValue       String?
  price             Decimal?
  receiver          String
  contactNumber     String
  address           String
  locationId        Int?
  locationName      String?
  wardName          String?
  weight            Decimal?
  length            Decimal?
  width             Decimal?
  height            Decimal?
  partnerDeliveryId Int?
  usingPriceCod     Boolean  @default(false)
  priceCodPayment   Decimal?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  invoice         Invoice          @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  location        Location?        @relation(fields: [locationId], references: [id])
  partnerDelivery PartnerDelivery? @relation(fields: [partnerDeliveryId], references: [id])

  @@map("invoice_deliveries")
}

// ==================== PURCHASE ORDER (NHẬP HÀNG) ====================

model PurchaseOrder {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  supplierId    Int
  branchId      Int?
  purchaseDate  DateTime
  totalAmount   Decimal  @default(0)
  discount      Decimal  @default(0)
  discountRatio Decimal  @default(0)
  shippingFee   Decimal  @default(0)
  otherFees     Decimal  @default(0)
  grandTotal    Decimal  @default(0)
  paidAmount    Decimal  @default(0)
  debtAmount    Decimal  @default(0)
  paymentStatus String   @default("Draft")
  partnerType   String?
  isDraft       Boolean  @default(false)
  description   String?
  purchaseById  Int?
  createdBy     Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  supplier   Supplier                 @relation(fields: [supplierId], references: [id])
  branch     Branch?                  @relation(fields: [branchId], references: [id])
  purchaseBy User?                    @relation("PurchaseOrderBuyer", fields: [purchaseById], references: [id])
  creator    User                     @relation("PurchaseOrderCreator", fields: [createdBy], references: [id])
  items      PurchaseOrderItem[]
  payments   PurchaseOrderPayment[]
  surcharges PurchaseOrderSurcharge[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              Int      @id @default(autoincrement())
  purchaseOrderId Int
  productId       Int
  productCode     String
  productName     String
  quantity        Decimal
  price           Decimal 
  discount        Decimal  @default(0)
  discountRatio   Decimal  @default(0)
  totalPrice      Decimal 
  description     String?
  serialNumbers   String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product       Product       @relation(fields: [productId], references: [id])

  @@map("purchase_order_items")
}

model PurchaseOrderPayment {
  id              Int      @id @default(autoincrement())
  code            String   @unique
  purchaseOrderId Int
  amount          Decimal 
  paymentDate     DateTime @default(now())
  paymentMethod   String   @default("cash")
  accountId       Int?
  description     String?
  status          Int      @default(1)
  statusValue     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  account       BankAccount?  @relation(fields: [accountId], references: [id])

  @@map("purchase_order_payments")
}

model PurchaseOrderSurcharge {
  id                Int      @id @default(autoincrement())
  purchaseOrderId   Int
  surchargeCode     String
  surchargeName     String
  value             Decimal?
  valueRatio        Decimal?
  isSupplierExpense Boolean  @default(false)
  type              Int      @default(0)
  createdAt         DateTime @default(now())

  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  surcharge     Surcharge?    @relation(fields: [surchargeCode], references: [code])

  @@map("purchase_order_surcharges")
}

model Post {
  id            Int       @id @default(autoincrement())
  title         String
  content       String?
  excerpt       String?
  featuredImage String?
  status        String    @default("draft")
  publishedAt   DateTime?
  authorId      Int
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  author   User       @relation("PostAuthor", fields: [authorId], references: [id])
  postMeta PostMeta[]
  tags     PostTag[]

  @@map("posts")
}

model PostMeta {
  id        Int      @id @default(autoincrement())
  postId    Int
  metaKey   String
  metaValue String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, metaKey])
  @@map("post_meta")
}

model Tag {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  posts PostTag[]

  @@map("tags")
}

model PostTag {
  postId    Int
  tagId     Int
  createdAt DateTime @default(now())

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag  Tag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([postId, tagId])
  @@map("post_tags")
}

model Settings {
  id                        Int      @id @default(autoincrement())
  managerCustomerByBranch   Boolean  @default(false)
  allowOrderWhenOutStock    Boolean  @default(true)
  allowSellWhenOrderOutStock Boolean @default(true)
  allowSellWhenOutStock     Boolean  @default(true)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("settings")
}

model Transfer {
  id                Int      @id @default(autoincrement())
  code              String   @unique
  fromBranchId      Int
  toBranchId        Int
  status            Int      @default(1)
  transferredDate   DateTime?
  receivedDate      DateTime?
  createdById       Int
  createdByName     String
  fromBranchName    String
  toBranchName      String
  noteBySource      String?
  noteByDestination String?
  totalTransfer     Decimal  @default(0)
  totalReceive      Decimal  @default(0)
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  fromBranch Branch            @relation("TransferFrom", fields: [fromBranchId], references: [id])
  toBranch   Branch            @relation("TransferTo", fields: [toBranchId], references: [id])
  creator    User              @relation("TransferCreator", fields: [createdById], references: [id])
  details    TransferDetail[]

  @@map("transfers")
}

model TransferDetail {
  id                   Int      @id @default(autoincrement())
  transferId           Int
  productId            Int
  productCode          String
  productName          String
  sendQuantity         Decimal
  receivedQuantity     Decimal  @default(0)
  sendPrice            Decimal 
  receivePrice         Decimal  @default(0)
  totalTransfer        Decimal 
  totalReceive         Decimal  @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  transfer Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id])

  @@map("transfer_details")
}
